{% extends "base.html" %}

{% block title %}Dummy Text Generator{% endblock %}

{% block content %}
<div class="tool-page-container">
    <div class="page-header">
        <a href="{{ url_for('dashboard') }}"
            class="p-4 hover:bg-[var(--m3-surface-container-high)] rounded-full transition-colors text-[var(--m3-on-surface)]">
            <span class="material-icons-round text-2xl">arrow_back</span>
        </a>
        <h2 class="text-3xl font-bold text-[var(--m3-on-surface)]">Dummy Text Generator</h2>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">

        <!-- Controls -->
        <div class="m3-card h-fit">
            <h3 class="text-xl font-bold mb-6">Einstellungen</h3>

            <div class="space-y-6">
                <div class="m3-input-group">
                    <label class="text-xs font-bold uppercase text-[var(--m3-primary)] mb-1">Anzahl</label>
                    <div class="flex items-center gap-2">
                        <input type="number" id="countInput" value="3" min="1" max="50"
                            class="m3-text-input text-center font-bold text-xl" oninput="generate()">
                    </div>
                </div>

                <div class="m3-input-group">
                    <label class="text-xs font-bold uppercase text-[var(--m3-primary)] mb-1">Einheit</label>
                    <select id="unitSelect" class="m3-text-input" onchange="generate()">
                        <option value="paragraphs">Absätze</option>
                        <option value="sentences">Sätze</option>
                        <option value="words">Wörter</option>
                    </select>
                </div>

                <div class="m3-switch-container">
                    <div class="flex flex-col">
                        <span class="font-medium text-base">Start mit "Lorem ipsum..."</span>
                    </div>
                    <label class="switch">
                        <input type="checkbox" id="startWithLorem" checked onchange="generate()">
                        <span class="slider"></span>
                    </label>
                </div>

                <button class="m3-button m3-button-filled w-full py-4 text-lg" onclick="generate()">
                    <span class="material-icons-round">refresh</span>
                    Neu generieren
                </button>

                <button class="m3-button m3-button-tonal w-full py-4 text-lg" onclick="copyText()">
                    <span class="material-icons-round">content_copy</span>
                    Kopieren
                </button>
            </div>
        </div>

        <!-- Output -->
        <div
            class="lg:col-span-2 m3-card bg-[var(--m3-surface)] border border-[var(--m3-outline-variant)] min-h-[500px] flex flex-col">
            <div class="flex justify-between items-center mb-4 pb-4 border-b border-[var(--m3-outline-variant)]">
                <span class="font-mono text-xs opacity-50 uppercase">Output</span>
                <span class="text-xs font-bold text-[var(--m3-primary)]" id="statsDisplay">0 Wörter</span>
            </div>

            <div id="outputArea"
                class="flex-1 font-serif text-lg leading-relaxed text-[var(--m3-on-surface)] overflow-y-auto whitespace-pre-wrap p-2">
            </div>
        </div>
    </div>
</div>

<script>
    const dictionary = [
        "lorem", "ipsum", "dolor", "sit", "amet", "consectetur", "adipiscing", "elit", "sed", "do", "eiusmod", "tempor", "incididunt", "ut", "labore", "et", "dolore", "magna", "aliqua", "ut", "enim", "ad", "minim", "veniam", "quis", "nostrud", "exercitation", "ullamco", "laboris", "nisi", "ut", "aliquip", "ex", "ea", "commodo", "consequat", "duis", "aute", "irure", "dolor", "in", "reprehenderit", "in", "voluptate", "velit", "esse", "cillum", "dolore", "eu", "fugiat", "nulla", "pariatur", "excepteur", "sint", "occaecat", "cupidatat", "non", "proident", "sunt", "in", "culpa", "qui", "officia", "deserunt", "mollit", "anim", "id", "est", "laborum"
    ];

    function randomWord() {
        return dictionary[Math.floor(Math.random() * dictionary.length)];
    }

    function generateSentence() {
        const length = Math.floor(Math.random() * 10) + 8; // 8-18 words
        let sentence = [];
        for (let i = 0; i < length; i++) {
            sentence.push(randomWord());
        }
        // Capitalize first
        sentence[0] = sentence[0].charAt(0).toUpperCase() + sentence[0].slice(1);
        return sentence.join(" ") + ".";
    }

    function generateParagraph() {
        const length = Math.floor(Math.random() * 5) + 3; // 3-8 sentences
        let p = [];
        for (let i = 0; i < length; i++) {
            p.push(generateSentence());
        }
        return p.join(" ");
    }

    function generate() {
        const count = parseInt(document.getElementById('countInput').value);
        const unit = document.getElementById('unitSelect').value;
        const startLorem = document.getElementById('startWithLorem').checked;
        const output = document.getElementById('outputArea');
        const stats = document.getElementById('statsDisplay');

        let result = "";
        let words = 0;

        if (unit === 'words') {
            let list = [];
            for (let i = 0; i < count; i++) list.push(randomWord());
            result = list.join(" ");

            if (startLorem) {
                // simple hack, replace first words
                let arr = result.split(" ");
                if (arr.length > 0) arr[0] = "Lorem";
                if (arr.length > 1) arr[1] = "ipsum";
                if (arr.length > 2) arr[2] = "dolor";
                if (arr.length > 3) arr[3] = "sit";
                if (arr.length > 4) arr[4] = "amet";
                result = arr.join(" ");
            }
            // Capitalize
            result = result.charAt(0).toUpperCase() + result.slice(1);

        } else if (unit === 'sentences') {
            let list = [];
            for (let i = 0; i < count; i++) list.push(generateSentence());
            result = list.join(" ");
            if (startLorem) {
                result = "Lorem ipsum dolor sit amet, " + result.charAt(0).toLowerCase() + result.slice(1);
            }

        } else { // paragraphs
            let list = [];
            for (let i = 0; i < count; i++) list.push(generateParagraph());
            result = list.join("\n\n");
            if (startLorem) {
                // Replace start of first paragraph
                let firstSpace = result.indexOf(" ");
                // simple replacement logic is complex for existing sentences. 
                // Let's just prepend if it's new text or ensure it starts.
                if (!result.toLowerCase().startsWith("lorem")) {
                    result = "Lorem ipsum dolor sit amet, consectetur adipiscing elit. " + result;
                }
            }
        }

        output.textContent = result;

        // Count words
        words = result.split(/\s+/).filter(w => w.length > 0).length;
        stats.textContent = `${words} Wörter • ${result.length} Zeichen`;
    }

    function copyText() {
        const text = document.getElementById('outputArea').textContent;
        navigator.clipboard.writeText(text).then(() => {
            showToast("Text kopiert!");
        });
    }

    // Init
    generate();

</script>
{% endblock %}