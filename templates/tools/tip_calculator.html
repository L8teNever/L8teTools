{% extends "base.html" %}

{% block title %}Trinkgeld Rechner{% endblock %}

{% block content %}
<div class="tool-page-container">
    <div class="page-header">
        <a href="{{ url_for('dashboard') }}"
            class="p-4 hover:bg-[var(--m3-surface-container-high)] rounded-full transition-colors text-[var(--m3-on-surface)]">
            <span class="material-icons-round text-2xl">arrow_back</span>
        </a>
        <h2 class="text-3xl font-bold text-[var(--m3-on-surface)]">Trinkgeld Rechner</h2>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-8 max-w-5xl mx-auto">

        <!-- Input Section -->
        <div class="m3-card space-y-8">
            <!-- Bill Amount -->
            <div class="space-y-2">
                <label
                    class="text-xs font-bold uppercase text-[var(--m3-primary)] tracking-wider">Rechnungsbetrag</label>
                <div
                    class="flex items-center bg-[var(--m3-surface-container)] rounded-2xl px-4 py-2 border border-[var(--m3-outline-variant)] focus-within:border-[var(--m3-primary)] focus-within:ring-2 ring-[var(--m3-primary)]/20 transition-all">
                    <span class="text-xl font-bold text-[var(--m3-on-surface-variant)]">€</span>
                    <input type="number" id="billAmount"
                        class="w-full bg-transparent border-none outline-none text-right font-bold text-2xl p-2"
                        placeholder="0.00" step="0.01" oninput="calculate()">
                </div>
            </div>

            <!-- Tip Percentage -->
            <div class="space-y-4">
                <div class="flex justify-between items-center">
                    <label class="text-xs font-bold uppercase text-[var(--m3-primary)] tracking-wider">Trinkgeld
                        %</label>
                    <span id="tipPercentDisplay" class="font-bold text-xl">10%</span>
                </div>

                <input type="range" id="tipRange" min="0" max="50" value="10" class="m3-slider w-full"
                    oninput="updateTipFromSlider(this.value)">

                <div class="grid grid-cols-5 gap-2">
                    <button
                        class="py-2 rounded-xl bg-[var(--m3-surface-container)] hover:bg-[var(--m3-primary-container)] transition-colors text-sm font-bold"
                        onclick="setTip(0)">0%</button>
                    <button
                        class="py-2 rounded-xl bg-[var(--m3-surface-container)] hover:bg-[var(--m3-primary-container)] transition-colors text-sm font-bold"
                        onclick="setTip(5)">5%</button>
                    <button
                        class="py-2 rounded-xl bg-[var(--m3-primary-container)] text-[var(--m3-on-primary-container)] hover:brightness-110 transition-colors text-sm font-bold ring-2 ring-[var(--m3-primary)]"
                        onclick="setTip(10)" id="btn10">10%</button>
                    <button
                        class="py-2 rounded-xl bg-[var(--m3-surface-container)] hover:bg-[var(--m3-primary-container)] transition-colors text-sm font-bold"
                        onclick="setTip(15)">15%</button>
                    <button
                        class="py-2 rounded-xl bg-[var(--m3-surface-container)] hover:bg-[var(--m3-primary-container)] transition-colors text-sm font-bold"
                        onclick="setTip(20)">20%</button>
                </div>
            </div>

            <!-- People Count -->
            <div class="space-y-4">
                <div class="flex justify-between items-center">
                    <label class="text-xs font-bold uppercase text-[var(--m3-primary)] tracking-wider">Anzahl
                        Personen</label>
                    <span id="peopleDisplay" class="font-bold text-xl">1</span>
                </div>
                <div class="flex items-center gap-4">
                    <button
                        class="w-12 h-12 rounded-full bg-[var(--m3-surface-container-high)] flex items-center justify-center hover:bg-[var(--m3-primary-container)] transition-colors"
                        onclick="changePeople(-1)">
                        <span class="material-icons-round">remove</span>
                    </button>
                    <input type="range" id="peopleRange" min="1" max="20" value="1" class="flex-1 m3-slider"
                        oninput="updatePeopleFromSlider(this.value)">
                    <button
                        class="w-12 h-12 rounded-full bg-[var(--m3-surface-container-high)] flex items-center justify-center hover:bg-[var(--m3-primary-container)] transition-colors"
                        onclick="changePeople(1)">
                        <span class="material-icons-round">add</span>
                    </button>
                </div>
            </div>
        </div>

        <!-- Result Section -->
        <div
            class="m3-card bg-[var(--m3-primary-container)] text-[var(--m3-on-primary-container)] flex flex-col justify-between p-8 md:p-12 relative overflow-hidden">
            <!-- Decorative blob -->
            <div class="absolute -top-10 -right-10 w-40 h-40 bg-[var(--m3-primary)] rounded-full opacity-20 blur-3xl">
            </div>

            <div class="space-y-8 relative z-10">
                <div class="flex justify-between items-end border-b border-[var(--m3-on-primary-container)]/20 pb-4">
                    <div>
                        <div class="text-sm font-bold opacity-70">Trinkgeld Betrag</div>
                        <div class="text-xs opacity-50">Gesamt</div>
                    </div>
                    <div class="text-4xl font-bold flex items-start">
                        <span class="text-2xl mt-1 opacity-70">€</span>
                        <span id="totalTipDisplay">0.00</span>
                    </div>
                </div>

                <div class="flex justify-between items-end border-b border-[var(--m3-on-primary-container)]/20 pb-4">
                    <div>
                        <div class="text-sm font-bold opacity-70">Gesamtsumme</div>
                        <div class="text-xs opacity-50">Rechnung + Trinkgeld</div>
                    </div>
                    <div class="text-4xl font-bold flex items-start">
                        <span class="text-2xl mt-1 opacity-70">€</span>
                        <span id="totalDisplay">0.00</span>
                    </div>
                </div>

                <div class="flex justify-between items-end pt-2">
                    <div>
                        <div class="text-sm font-bold opacity-70">Pro Person</div>
                        <div class="text-xs opacity-50">Bei Aufteilung</div>
                    </div>
                    <div class="text-6xl font-bold flex items-start text-[var(--m3-on-primary-container)]">
                        <span class="text-3xl mt-2 opacity-70">€</span>
                        <span id="perPersonDisplay">0.00</span>
                    </div>
                </div>
            </div>

            <div class="mt-8 text-center opacity-50 text-sm">
                Berechnung erfolgt automatisch
            </div>
        </div>

    </div>
</div>

<script>
    const billInput = document.getElementById('billAmount');
    const tipRange = document.getElementById('tipRange');
    const peopleRange = document.getElementById('peopleRange');

    function calculate() {
        let bill = parseFloat(billInput.value);
        if (isNaN(bill)) bill = 0;

        const tipPercent = parseInt(tipRange.value);
        const people = parseInt(peopleRange.value);

        const tipAmount = bill * (tipPercent / 100);
        const total = bill + tipAmount;
        const perPerson = total / people;

        // Update UI
        document.getElementById('totalTipDisplay').textContent = tipAmount.toFixed(2);
        document.getElementById('totalDisplay').textContent = total.toFixed(2);
        document.getElementById('perPersonDisplay').textContent = perPerson.toFixed(2);
    }

    function updateTipFromSlider(val) {
        document.getElementById('tipPercentDisplay').textContent = val + "%";

        // Reset button styles
        document.querySelectorAll('.grid button').forEach(b => {
            b.className = 'py-2 rounded-xl bg-[var(--m3-surface-container)] hover:bg-[var(--m3-primary-container)] transition-colors text-sm font-bold';
        });

        calculate();
    }

    function setTip(val) {
        tipRange.value = val;
        updateTipFromSlider(val);

        // Highlight active button (rough logic)
        // In a real app we'd use IDs or data attrs more cleanly
    }

    function updatePeopleFromSlider(val) {
        document.getElementById('peopleDisplay').textContent = val;
        calculate();
    }

    function changePeople(delta) {
        let val = parseInt(peopleRange.value) + delta;
        if (val < 1) val = 1;
        if (val > 50) val = 50;
        peopleRange.value = val;
        updatePeopleFromSlider(val);
    }
</script>
{% endblock %}