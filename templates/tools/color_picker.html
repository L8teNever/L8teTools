{% extends "base.html" %}

{% block title %}Farbw채hler{% endblock %}

{% block content %}
<div class="tool-page-container">
    <div class="page-header">
        <a href="{{ url_for('dashboard') }}"
            class="p-4 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-full transition-colors">
            <span class="material-icons-round text-2xl">arrow_back</span>
        </a>
        <h2 class="text-3xl font-bold text-gray-800 dark:text-gray-100">Farbw채hler</h2>
    </div>

    <div class="tool-grid">
        <!-- Color Preview & Picker Column -->
        <div class="m3-card flex flex-col items-center gap-8 min-h-[450px]">
            <div id="colorDisplay"
                class="w-full h-48 rounded-3xl shadow-inner border-4 border-white dark:border-gray-800 transition-colors duration-200 relative group overflow-hidden">
                <input type="color" id="mainPicker" class="absolute inset-0 w-full h-full opacity-0 cursor-pointer"
                    value="#4285F4">
                <div
                    class="absolute inset-x-0 bottom-0 p-4 bg-black/20 backdrop-blur-sm text-white text-center opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none">
                    Klicken zum W채hlen
                </div>
            </div>

            <div class="grid grid-cols-1 w-full gap-4">
                <div class="m3-input-group">
                    <label class="text-xs font-bold text-gray-500 uppercase px-1 mb-2 block">HEX Code</label>
                    <div class="relative">
                        <input type="text" id="hexInput" class="m3-text-input pl-10" value="#4285F4"
                            placeholder="#000000">
                        <span
                            class="material-icons-round absolute left-3 top-1/2 -translate-y-1/2 text-gray-400">tag</span>
                        <button
                            class="absolute right-2 top-1/2 -translate-y-1/2 p-2 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-lg"
                            onclick="copyValue('hexInput')">
                            <span class="material-icons-round text-sm">content_copy</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Conversions & Sliders Column -->
        <div class="m3-card space-y-8">
            <h3 class="text-lg font-bold mb-4">Werte & Formate</h3>

            <!-- RGB Values -->
            <div class="space-y-4">
                <div class="flex justify-between items-center px-1">
                    <span class="text-sm font-medium text-gray-600 dark:text-gray-400">RGB</span>
                    <button class="text-blue-600 dark:text-blue-400 text-sm font-bold" id="rgbDisplay"
                        onclick="copyText(this.textContent)">rgb(66, 133, 244)</button>
                </div>
                <div class="space-y-3">
                    <div class="flex items-center gap-4">
                        <span class="w-4 font-bold text-red-500">R</span>
                        <input type="range" min="0" max="255" value="66" class="m3-slider flex-1" id="redRange">
                    </div>
                    <div class="flex items-center gap-4">
                        <span class="w-4 font-bold text-green-500">G</span>
                        <input type="range" min="0" max="255" value="133" class="m3-slider flex-1" id="greenRange">
                    </div>
                    <div class="flex items-center gap-4">
                        <span class="w-4 font-bold text-blue-500">B</span>
                        <input type="range" min="0" max="255" value="244" class="m3-slider flex-1" id="blueRange">
                    </div>
                </div>
            </div>

            <hr class="border-gray-100 dark:border-gray-800">

            <!-- HSL Values -->
            <div class="space-y-4">
                <div class="flex justify-between items-center px-1">
                    <span class="text-sm font-medium text-gray-600 dark:text-gray-400">HSL</span>
                    <button class="text-blue-600 dark:text-blue-400 text-sm font-bold" id="hslDisplay"
                        onclick="copyText(this.textContent)">hsl(217, 89%, 61%)</button>
                </div>
            </div>

            <div class="bg-gray-50 dark:bg-gray-900/50 p-4 rounded-2xl text-xs text-gray-500 flex items-start gap-3">
                <span class="material-icons-round text-sm mt-0.5">info</span>
                <p>Nutze den Farbw채hler oben oder gib direkt einen HEX-Code ein. Die RGB-Schieberegler aktualisieren
                    sich automatisch.</p>
            </div>
        </div>
    </div>
</div>

<script>
    const mainPicker = document.getElementById('mainPicker');
    const colorDisplay = document.getElementById('colorDisplay');
    const hexInput = document.getElementById('hexInput');
    const redRange = document.getElementById('redRange');
    const greenRange = document.getElementById('greenRange');
    const blueRange = document.getElementById('blueRange');
    const rgbDisplay = document.getElementById('rgbDisplay');
    const hslDisplay = document.getElementById('hslDisplay');

    function updateFromHex(hex) {
        if (!/^#[0-9A-F]{6}$/i.test(hex)) return;

        const r = parseInt(hex.slice(1, 3), 16);
        const g = parseInt(hex.slice(3, 5), 16);
        const b = parseInt(hex.slice(5, 7), 16);

        redRange.value = r;
        greenRange.value = g;
        blueRange.value = b;

        syncAll(hex, r, g, b);
    }

    function updateFromRGB() {
        const r = parseInt(redRange.value);
        const g = parseInt(greenRange.value);
        const b = parseInt(blueRange.value);
        const hex = rgbToHex(r, g, b);

        syncAll(hex, r, g, b);
    }

    function updateFromPicker() {
        updateFromHex(mainPicker.value);
    }

    function syncAll(hex, r, g, b) {
        colorDisplay.style.backgroundColor = hex;
        mainPicker.value = hex;
        hexInput.value = hex.toUpperCase();
        rgbDisplay.textContent = `rgb(${r}, ${g}, ${b})`;

        const hsl = rgbToHsl(r, g, b);
        hslDisplay.textContent = `hsl(${hsl.h}, ${hsl.s}%, ${hsl.l}%)`;
    }

    function rgbToHex(r, g, b) {
        return "#" + ((1 << 24) + (r << 16) + (g << 8) + b).toString(16).slice(1);
    }

    function rgbToHsl(r, g, b) {
        r /= 255; g /= 255; b /= 255;
        const max = Math.max(r, g, b), min = Math.min(r, g, b);
        let h, s, l = (max + min) / 2;

        if (max === min) {
            h = s = 0;
        } else {
            const d = max - min;
            s = l > 0.5 ? d / (2 - max - min) : d / (max + min);
            switch (max) {
                case r: h = (g - b) / d + (g < b ? 6 : 0); break;
                case g: h = (b - r) / d + 2; break;
                case b: h = (r - g) / d + 4; break;
            }
            h /= 6;
        }

        return {
            h: Math.round(h * 360),
            s: Math.round(s * 100),
            l: Math.round(l * 100)
        };
    }

    function copyValue(id) {
        const input = document.getElementById(id);
        copyText(input.value);
    }

    function copyText(text) {
        navigator.clipboard.writeText(text).then(() => {
            showToast('Kopiert: ' + text);
        });
    }

    mainPicker.addEventListener('input', updateFromPicker);
    hexInput.addEventListener('input', (e) => updateFromHex(e.target.value));
    redRange.addEventListener('input', updateFromRGB);
    greenRange.addEventListener('input', updateFromRGB);
    blueRange.addEventListener('input', updateFromRGB);

    // Initial sync
    updateFromHex(mainPicker.value);
</script>
{% endblock %}